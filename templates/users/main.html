{% extends "base.html" %}
{% load static %}
{% block content %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="{% static "users/main.css" %}">
    <div class="calendar-wrapper">
        <div class="calendar">

            <div class="month">
                <span id="prevMonth">&lt;</span>
                <h2 id="currentMonth"></h2>
                <span id="nextMonth">&gt;</span>
            </div>

            <div class="weekdays">
                <div>Sun</div>
                <div>Mon</div>
                <div>Tue</div>
                <div>Wed</div>
                <div>Thu</div>
                <div>Fri</div>
                <div>Sat</div>
            </div>

            <div class="days" id="days"></div>
        </div>
    </div>

    <script>
        const currentMonthElement = document.getElementById("currentMonth");
        const daysContainer = document.getElementById("days");
        const prevMonthButton = document.getElementById("prevMonth");
        const nextMonthButton = document.getElementById("nextMonth");

        let currentDate = new Date();
        let selectedDate = null;

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            currentMonthElement.textContent = new Date(year, month).toLocaleString("en-US", { year: "numeric", month: "long" });

            const firstDayIndex = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            daysContainer.innerHTML = "";

            for (let i = 0; i < firstDayIndex; i++) {
                const emptyDiv = document.createElement("div");
                emptyDiv.classList.add("empty");
                daysContainer.appendChild(emptyDiv);
            }

            for (let day = 1; day <= lastDate; day++) {
                const dayElement = document.createElement("div");
                dayElement.classList.add("day");
                dayElement.textContent = day;

                const fullDate = new Date(year, month, day);

                if (
                    fullDate.getFullYear() === today.getFullYear() &&
                    fullDate.getMonth() === today.getMonth() &&
                    fullDate.getDate() === today.getDate()
                ) {
                    dayElement.classList.add("today");
                }

                if (fullDate < today) {
                    dayElement.classList.add("past");
                }

                const cloudIcon = document.createElement("div");
                cloudIcon.classList.add("cloud-icon");
                cloudIcon.innerHTML = `
                    <svg width="49" height="55" viewBox="0 0 49 55" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13.2408 45.8333C10.1513 45.8333 7.51199 44.6302 5.32285 42.2239C3.13371 39.8177 2.03847 36.8767 2.03711 33.401C2.03711 30.4218 2.83495 27.7673 4.43063 25.4375C6.02631 23.1076 8.11427 21.618 10.6945 20.9687C11.5433 17.4548 13.2408 14.6093 15.7871 12.4323C18.3334 10.2552 21.2192 9.16663 24.4445 9.16663C28.4167 9.16663 31.7867 10.7234 34.5543 13.837C37.322 16.9507 38.7051 20.7411 38.7038 25.2083C41.0464 25.5138 42.9904 26.6505 44.5358 28.6183C46.0812 30.5861 46.8533 32.8869 46.8519 35.5208C46.8519 38.3854 45.9611 40.8207 44.1793 42.8266C42.3976 44.8326 40.2329 45.8348 37.6853 45.8333H13.2408Z" fill="#C3E7FA"/>
                    </svg>
                `;
                dayElement.appendChild(cloudIcon);

                dayElement.addEventListener("click", () => {
                    if (!dayElement.classList.contains("past")) {
                        if (selectedDate) {
                            selectedDate.classList.remove("selected");
                        }
                        dayElement.classList.add("selected");
                        selectedDate = dayElement;
                    }
                });

                daysContainer.appendChild(dayElement);
            }
        }

        prevMonthButton.addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        nextMonthButton.addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        renderCalendar();
    </script>

{% endblock %}
