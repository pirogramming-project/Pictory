{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'users/main.css' %}">
{% endblock %}

{% block content %}
    <div class="main-container_psy">
        <div class="calendar-wrapper_psy">
            <div class="calendar_psy">
    
                <div class="month_psy">
                    <span id="prevMonth_psy">&lt;</span>
                    <h2 id="currentMonth_psy"></h2>
                    <span id="nextMonth_psy">&gt;</span>
                </div>
    
                <div class="weekdays_psy">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                </div>
    
                <div class="days_psy" id="days_psy"></div>
            </div>
        </div>

        <div class="today_diary_psy">
            <div class="today_diary_list_psy">
                <h2>{{ selected_date|date:"Y년 m월 d일" }}에 작성된 일기 목록</h2>
            </div>
            <div class="today_diary_content_psy">
                <ul>
                    {% for diary in diaries %}
                    <li>
                        <a href="{% url 'diaries:diary_detail' diary.id %}">{{ diary.title }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    


    <script>
        const currentMonthElement = document.getElementById("currentMonth_psy");
        const daysContainer = document.getElementById("days_psy");
        const prevMonthButton = document.getElementById("prevMonth_psy");
        const nextMonthButton = document.getElementById("nextMonth_psy");
        
        let currentDate = new Date();
        let selectedDate = null;

        // 날짜 클릭이벤트 추가
        function handleDateClick(year, month, day) {
            const url = `/diary/by_date/${year}/${month + 1}/${day}/`; // URL에 날짜 추가
            window.location.href = url; // 해당 URL로 이동
        }
        
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
        
            currentMonthElement.textContent = new Date(year, month).toLocaleString("en-US", { year: "numeric", month: "long" });
        
            const firstDayIndex = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const today = new Date();
        
            daysContainer.innerHTML = "";
        
            for (let i = 0; i < firstDayIndex; i++) {
                const emptyDiv = document.createElement("div");
                emptyDiv.classList.add("empty");
                daysContainer.appendChild(emptyDiv);
            }
        
            for (let day = 1; day <= lastDate; day++) {
                const dayElement = document.createElement("div");
                dayElement.classList.add("day_psy");
        
                const daySpan = document.createElement("span");
                daySpan.textContent = day;
                dayElement.appendChild(daySpan);
        
                const fullDate = new Date(year, month, day);

                // 날짜 클릭 이벤트
                dayElement.addEventListener("click", () => {
                    handleDateClick(year, month, day); // 특정 날짜 클릭 시 이동
                });

                daysContainer.appendChild(dayElement); //
        
                if (
                    fullDate.getFullYear() === today.getFullYear() &&
                    fullDate.getMonth() === today.getMonth() &&
                    fullDate.getDate() === today.getDate()
                ) {
                    dayElement.classList.add("today");
                }
        
                if (fullDate < today) {
                    dayElement.classList.add("past");
                }
        
                dayElement.addEventListener("click", () => {
                    if (!dayElement.classList.contains("past")) {
                        if (selectedDate) {
                            selectedDate.classList.remove("selected");
                        }
                        dayElement.classList.add("selected");
                        selectedDate = dayElement;
                    }
                });
        
                daysContainer.appendChild(dayElement);
            }
        }
        
        prevMonthButton.addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });
        
        nextMonthButton.addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });
        
        renderCalendar();
    </script>

{% endblock %}