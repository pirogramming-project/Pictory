{% extends "base.html" %}
{% load static %}

{%block head%}
<link rel="stylesheet" href="{% static 'diaries/custom_photo.css' %}">
{% endblock %}

{% block content %}
<body>

    <div class="container_psy">
        <div id="pictory-frame_psy">
            <div class="image-slot_psy" onclick="uploadImage_psy(0)"><span>+</span></div>
            <div class="image-slot_psy" onclick="uploadImage_psy(1)"><span>+</span></div>
            <div class="image-slot_psy" onclick="uploadImage_psy(2)"><span>+</span></div>
            <div class="image-slot_psy" onclick="uploadImage_psy(3)"><span>+</span></div>
        </div>

        <div class="custom-buttons_psy">
            <button class="cloud-btn_psy" data-page_psy="color">색깔</button>
            <button class="cloud-btn_psy" data-page_psy="logo">로고 수정</button>
            <button class="cloud-btn_psy" data-page_psy="thickness">두께</button>
            <button class="cloud-btn_psy" data-page_psy="sticker">스티커</button>
        </div>

        <!-- AJAX로 불러올 내용을 표시할 영역 -->
        <div id="customization-area_psy"></div>
    </div>

    <input type="file" id="imageInput_psy" accept="image/*" style="display: none;" onchange="previewImage_psy(event)">

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".cloud-btn_psy").forEach(button_psy => {
                button_psy.addEventListener("click", function () {
                    let page_psy = this.getAttribute("data-page_psy");
                    loadCustomizationPage_psy(page_psy);
                });
            });
        });

        function loadCustomizationPage_psy(page_psy) {
            let xhr_psy = new XMLHttpRequest();
            xhr_psy.open("GET", "/diaries/pages/" + page_psy + ".html", true);
            xhr_psy.onreadystatechange = function () {
                if (xhr_psy.readyState === 4 && xhr_psy.status === 200) {
                    document.getElementById("customization-area_psy").innerHTML = xhr_psy.responseText;
                    document.getElementById("customization-area_psy").style.display = "block";
                }
            };
            xhr_psy.send();
        }

        function uploadImage_psy(slotIndex_psy) {
            selectedSlot_psy = slotIndex_psy;
            document.getElementById("imageInput_psy").click();
        }

        function previewImage_psy(event) {
            let files_psy = event.target.files;
            if (files_psy.length > 0 && selectedSlot_psy !== null) {
                let reader_psy = new FileReader();
                reader_psy.onload = function(e_psy) {
                    let imageSlots_psy = document.querySelectorAll(".image-slot_psy");
                    imageSlots_psy[selectedSlot_psy].innerHTML = `<img src="${e_psy.target.result}" style="width:100%; height:100%; border-radius: 5px;">`;
                };
                reader_psy.readAsDataURL(files_psy[0]);
            }
        }
    </script>

</body>
{% endblock %}
